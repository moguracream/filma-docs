# Filma API 仕様書(2025/05/16現在)

## 概要

FilmaAPIはメディアファイルの管理、エンコード、ストレージ情報へのアクセスを提供するRESTful APIです。

## 認証

すべてのAPIリクエストには`api_key`パラメータが必要です。

**認証エラー**:
- ステータスコード: 401
- レスポンス: "unauthorized"

## 共通エラー

**サーバーエラー**:
- ステータスコード: 500
- レスポンス形式: `ERROR. inquiry number: [logid]`

**リソース未検出**:
- ステータスコード: 404
- レスポンス: "not found"

## エンドポイント

### ストレージAPI

#### ファイル一覧の取得

**リクエスト**:
- メソッド: GET
- URL: `/filmaapi/storage`
- パラメータ: 
  - `api_key`: 認証キー（必須）

**レスポンス**:
- ステータスコード: 200
- コンテンツタイプ: application/json
- 形式:
```json
[
  {
    "id": 123,
    "filename": "ファイル名",
    "folder_id": 456,
    "folder_name": "フォルダ名",
    "created_at": "作成日時",
    "updated_at": "更新日時",
    "creator": "作成者名",
    "updater": "更新者名"
  },
  ...
]
```

#### 特定ファイルのダウンロード

**リクエスト**:
- メソッド: GET
- URL: `/filmaapi/storage/:id`
- パラメータ:
  - `api_key`: 認証キー（必須）
  - `id`: ファイルID（URLパス内）

**レスポンス**:
- 成功時: 指定されたファイルのダウンロードURLへリダイレクト（60秒間有効なHTTPSリンク）
- 失敗時: 404 Not Found

#### ファイルのメタデータ取得

**リクエスト**:
- メソッド: GET
- URL: `/filmaapi/storage/metadata/:id`
- パラメータ:
  - `api_key`: 認証キー（必須）
  - `id`: ファイルID（URLパス内）

**レスポンス**:
- ステータスコード: 200
- コンテンツタイプ: application/json
- 形式:
```json
{
  "id": 123,
  "name": "ファイル名",
  "folder_id": 456,
  "folder_name": "フォルダ名",
  "created_at": "作成日時",
  "updated_at": "更新日時",
  "creator": "作成者名",
  "updater": "更新者名",
  "player_data": [
    {
      "resolution_string": "HD 1280x720",
      "filesize_megabyte": 45.2,
      "bitrate_human": "2.5Mbps",
      "device_string": "ストリーミング iOS/Mac",
      "player_url": "https://example.com/player/789",
      "player_embedding_html": "<iframe>...</iframe>"
    },
    ...
  ]
}
```

#### ストレージ情報の取得（未実装）

**リクエスト**:
- メソッド: GET
- URL: `/filmaapi/storage/metadata`
- パラメータ:
  - `api_key`: 認証キー（必須）

**レスポンス**:
- ステータスコード: 200
- コンテンツタイプ: application/json
- 形式: 現在は空の配列を返します `[]`（仕様検討中）

#### ファイルのアップロード（未実装）
**リクエスト**:
- メソッド: POST
- URL: `/filmaapi/storage`
- パラメータ(仮):
  - `api_key`: 認証キー（必須）
  - `file`: アップロードするファイル（必須）
  - `folder_id`: アップロード先フォルダID（オプション）

**レスポンス(仮)**:
- ステータスコード: 200
- コンテンツタイプ: application/json
- 形式:
```json
{
  "id": 123,
  "filename": "ファイル名",
  "folder_id": 456,
  "folder_name": "フォルダ名",
  "created_at": "作成日時",
  "updated_at": "更新日時",
  "creator": "作成者名",
  "updater": "更新者名"
}
```

#### ファイルの削除

**リクエスト**:
- メソッド: DELETE
- URL: `/filmaapi/storage/:id`
- パラメータ:
  - `api_key`: 認証キー（必須）
  - `id`: 削除するファイルID（URLパス内）

**レスポンス**:
- ステータスコード: 200
- コンテンツタイプ: application/json
- 形式:
```json
{
  "id": 123,
  "status": "deleted",
  "filename": "ファイル名"
}
```

### エンコードAPI（未実装）

**注**: エンコードAPIは現在実装中で、詳細仕様は未定義です。

以下のエンドポイントが予定されています：
- `GET /filmaapi/encode/:id` - エンコード情報の取得
- `POST /filmaapi/encode` - 新規エンコードジョブの作成
- `DELETE /filmaapi/encode/:id` - エンコードジョブの削除

## データ型

### ファイル情報

- `id`: ファイルの一意識別子
- `name/filename`: ファイル名
- `folder_id`: 所属フォルダID
- `folder_name`: 所属フォルダ名
- `created_at`: 作成日時
- `updated_at`: 更新日時
- `creator`: 作成者名
- `updater`: 更新者名

### プレイヤーデータ

- `resolution_string`: 解像度情報（例: "HD 1280x720"）
- `filesize_megabyte`: ファイルサイズ（MB）
- `bitrate_human`: ビットレート（人間可読形式）
- `device_string`: 対応デバイス情報
- `player_url`: プレイヤーURL
- `player_embedding_html`: 埋め込み用HTMLコード

## 注意事項

- すべてのリクエストには有効な`api_key`が必要です
- ファイル一覧APIは現在ページング機能を実装していません
- ストレージ情報APIの詳細仕様は現在検討中です 
